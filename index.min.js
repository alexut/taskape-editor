(()=>{var e,t,i=Object.create,a=Object.defineProperty,r=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,n=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty,s=(e,t,s)=>(s=null!=e?i(n(e)):{},((t,s,i,n)=>{if(s&&"object"==typeof s||"function"==typeof s)for(let e of o(s))l.call(t,e)||e===i||a(t,e,{get:()=>s[e],enumerable:!(n=r(s,e))||n.enumerable});return t})(!t&&e&&e.__esModule?s:a(s,"default",{value:e,enumerable:!0}),e)),h=(e={"node_modules/eventemitter3/index.js"(e,t){var i=Object.prototype.hasOwnProperty,u="~";function s(){}function a(e,t,s){this.fn=e,this.context=t,this.once=s||!1}function n(e,t,s,i,n){if("function"!=typeof s)throw new TypeError("The listener must be a function");s=new a(s,i||e,n),i=u?u+t:t;return e._events[i]?e._events[i].fn?e._events[i]=[e._events[i],s]:e._events[i].push(s):(e._events[i]=s,e._eventsCount++),e}function l(e,t){0==--e._eventsCount?e._events=new s:delete e._events[t]}function r(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(u=!1)),r.prototype.eventNames=function(){var e,t,s=[];if(0===this._eventsCount)return s;for(t in e=this._events)i.call(e,t)&&s.push(u?t.slice(1):t);return Object.getOwnPropertySymbols?s.concat(Object.getOwnPropertySymbols(e)):s},r.prototype.listeners=function(e){var e=u?u+e:e,t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var s=0,i=t.length,n=new Array(i);s<i;s++)n[s]=t[s].fn;return n},r.prototype.listenerCount=function(e){e=u?u+e:e,e=this._events[e];return e?e.fn?1:e.length:0},r.prototype.emit=function(e,t,s,i,n,a){var r=u?u+e:e;if(!this._events[r])return!1;var o,l=this._events[r],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,s),!0;case 4:return l.fn.call(l.context,t,s,i),!0;case 5:return l.fn.call(l.context,t,s,i,n),!0;case 6:return l.fn.call(l.context,t,s,i,n,a),!0}for(p=1,o=new Array(h-1);p<h;p++)o[p-1]=arguments[p];l.fn.apply(l.context,o)}else for(var c,d=l.length,p=0;p<d;p++)switch(l[p].once&&this.removeListener(e,l[p].fn,void 0,!0),h){case 1:l[p].fn.call(l[p].context);break;case 2:l[p].fn.call(l[p].context,t);break;case 3:l[p].fn.call(l[p].context,t,s);break;case 4:l[p].fn.call(l[p].context,t,s,i);break;default:if(!o)for(c=1,o=new Array(h-1);c<h;c++)o[c-1]=arguments[c];l[p].fn.apply(l[p].context,o)}return!0},r.prototype.on=function(e,t,s){return n(this,e,t,s,!1)},r.prototype.once=function(e,t,s){return n(this,e,t,s,!0)},r.prototype.removeListener=function(e,t,s,i){e=u?u+e:e;if(this._events[e])if(t){var n=this._events[e];if(n.fn)n.fn!==t||i&&!n.once||s&&n.context!==s||l(this,e);else{for(var a=0,r=[],o=n.length;a<o;a++)(n[a].fn!==t||i&&!n[a].once||s&&n[a].context!==s)&&r.push(n[a]);r.length?this._events[e]=1===r.length?r[0]:r:l(this,e)}}else l(this,e);return this},r.prototype.removeAllListeners=function(e){return e?(e=u?u+e:e,this._events[e]&&l(this,e)):(this._events=new s,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=u,r.EventEmitter=r,void 0!==t&&(t.exports=r)}},function(){return t||(0,e[o(e)[0]])((t={exports:{}}).exports,t),t.exports}),c=s(h());function d(e){return"string"==typeof e?document.querySelector(e):e}function p(e,t,s){var i=m(s),n=s.offsetWidth,s=s.offsetHeight,a=i.x+n/2,i=i.y+s/2,e=Math.max(Math.abs(e-a)-n/2,0),a=Math.max(Math.abs(t-i)-s/2,0);return e*e+a*a}function u(e,t,s){var i=m(s),n=i.x,i=i.y,a=s.offsetWidth;return n<=e&&e<=n+a&&i<=t&&t<=i+s.offsetHeight}function m(e){var e=e.getBoundingClientRect(),t=document.body,s=document.documentElement,i=window.pageYOffset||s.scrollTop||t.scrollTop,n=window.pageXOffset||s.scrollLeft||t.scrollLeft,a=s.clientTop||t.clientTop||0,s=s.clientLeft||t.clientLeft||0,t=e.top+i-a,i=e.left+n-s;return{y:Math.round(t),x:Math.round(i)}}function _(e){e=e||{};let t=document.createElement(e.type||"div");if(e.parent&&e.parent.appendChild(t),e.className&&e.className.split(" ").forEach(e=>t.classList.add(e)),e.html&&(t.innerHTML=e.html),e.id&&(t.id=e.id),e.attributes)for(var s in e.attributes)t.setAttribute(s,e.attributes[s]);return t}var f=class{constructor(e){this._indicator=_(),this._indicator.style.marginLeft=e.indentation+"px";var t=_({parent:this._indicator});t.style.display="flex",this._indicator.indentation=_({parent:t}),this._indicator.icon=_({parent:t,className:e.prefixClassName+"-expand"}),this._indicator.icon.style.height=0,this._indicator.line=_({parent:t,className:e.prefixClassName+"-indicator"})}get(){return this._indicator}set marginLeft(e){this._indicator.style.marginLeft=e+"px"}},v=class{constructor(e){this._tree=e,this._indicator=new f(e),document.body.addEventListener("mousemove",e=>this._move(e)),document.body.addEventListener("touchmove",e=>this._move(e)),document.body.addEventListener("mouseup",e=>this._up(e)),document.body.addEventListener("touchend",e=>this._up(e)),document.body.addEventListener("mouseleave",e=>this._up(e))}_down(t){if(t.target.classList.contains(this._tree.prefixClassName+"-leaf-handler")){this._target=t.currentTarget.parentNode.parentNode;let e=!1;this._tree._selection===this._target?e=!0:(this._tree._selection&&this._tree._selection.querySelector(`.${this._tree.prefixClassName}-name`).classList.remove(this._tree.prefixClassName+"-select"),this._tree._selection=this._target,this._tree._selection.querySelector(`.${this._tree.prefixClassName}-name`).classList.add(this._tree.prefixClassName+"-select")),this._isDown={x:t.pageX,y:t.pageY,alreadySelected:e};var s=m(this._target);this._offset={x:t.pageX-s.x,y:t.pageY-s.y},this._tree.holdTime&&(this._holdTimeout=window.setTimeout(()=>this._hold(),this._tree.holdTime)),t.preventDefault(),t.stopPropagation()}else this._target=t.currentTarget.parentNode.parentNode,this._tree._selection!==this._target&&(this._tree._selection&&this._tree._selection.querySelector(`.${this._tree.prefixClassName}-name`).classList.remove(this._tree.prefixClassName+"-select"),this._tree._selection=this._target,this._tree._selection.querySelector(`.${this._tree.prefixClassName}-name`).classList.add(this._tree.prefixClassName+"-select"),this._tree.emit("selection-change",this._target,this._tree))}_hold(){this._holdTimeout=null,this._tree.edit(this._target)}_checkThreshold(e){return!!this._isDown&&!(!this._tree.move||!this._moving&&(t=this._isDown.x,s=this._isDown.y,i=e.pageX,e=e.pageY,!Math.sqrt(Math.pow(t-i,2)+Math.pow(s-e,2))||(this._moving=!0,this._pickup(),0)));var t,s,i}_pickup(){this._holdTimeout&&(window.clearTimeout(this._holdTimeout),this._holdTimeout=null),this._tree.emit("move-pending",this._target,this._tree);var e=this._target.parentNode,t=(e.insertBefore(this._indicator.get(),this._target),m(this._target));document.body.appendChild(this._target),this._old={opacity:this._target.style.opacity||"unset",position:this._target.style.position||"unset",boxShadow:this._target.querySelector(`.${this._tree.prefixClassName}-name`).style.boxShadow||"unset"},this._target.style.position="absolute",this._target.querySelector(`.${this._tree.prefixClassName}-name`).style.boxShadow="3px 3px 5px rgba(0,0,0,0.25)",this._target.style.left=t.x+"px",this._target.style.top=t.y+"px",this._target.style.opacity=this._tree.dragOpacity,0===this._tree._getChildren(e,!0).length&&((t=e.__leafInstance)?t.hideIcon():console.error("Leaf instance not found for parent element"))}_findClosest(e,t){var s,i;m(t.querySelector(`.${this._tree.prefixClassName}-name`)).y+t.querySelector(`.${this._tree.prefixClassName}-name`).offsetHeight/2<=e.pageY?this._closest.foundAbove||(u(e.pageX,e.pageY,t.querySelector(`.${this._tree.prefixClassName}-name`))?(this._closest.foundAbove=!0,this._closest.above=t):(s=p(e.pageX,e.pageY,t.querySelector(`.${this._tree.prefixClassName}-name`)))<this._closest.distanceAbove&&(this._closest.distanceAbove=s,this._closest.above=t)):this._closest.foundBelow||(u(e.pageX,e.pageY,t.querySelector(`.${this._tree.prefixClassName}-name`))?(this._closest.foundBelow=!0,this._closest.below=t):(s=p(e.pageX,e.pageY,t.querySelector(`.${this._tree.prefixClassName}-name`)))<this._closest.distanceBelow&&(this._closest.distanceBelow=s,this._closest.below=t));for(i of this._tree._getChildren(t))this._findClosest(e,i)}_move(e){if(this._target&&this._checkThreshold(e)){var t,s=this._tree.element,i=this._indicator.get(),n=this._tree.indentation,a=(i.remove(),this._target.style.left=e.pageX-this._offset.x+"px",this._target.style.top=e.pageY-this._offset.y+"px",m(this._target.querySelector(`.${this._tree.prefixClassName}-name`)).x);this._closest={distanceAbove:1/0,distanceBelow:1/0};for(t of this._tree._getChildren())this._findClosest(e,t);if(this._closest.above||this._closest.below)if(this._closest.above)if(this._closest.below)if(this._closest.below.parentNode===this._closest.above)this._closest.above.insertBefore(i,this._closest.below);else if(this._closest.below.parentNode===this._closest.above.parentNode)a>m(this._closest.above.querySelector(`.${this._tree.prefixClassName}-name`)).x+n?this._closest.above.insertBefore(i,this._tree._getLastChild(this._closest.above,!0)):this._closest.above.parentNode.insertBefore(i,this._closest.below);else{let t=m(this._closest.above.querySelector(`.${this._tree.prefixClassName}-name`));if(a>t.x+n)this._closest.above.insertBefore(i,this._tree._getLastChild(this._closest.above,!0));else if(a>t.x-n)this._closest.above.parentNode.appendChild(i);else if(a<m(this._closest.below.querySelector(`.${this._tree.prefixClassName}-name`)).x)this._closest.below.parentNode.insertBefore(i,this._closest.below);else{let e=this._closest.above;for(;e.parentNode!==this._closest.below.parentNode&&a<t.x;)e=this._tree._getParent(e),t=m(e.querySelector(`.${this._tree.prefixClassName}-name`));e.appendChild(i)}}else{let t=m(this._closest.above.querySelector(`.${this._tree.prefixClassName}-name`));if(a>t.x+n)this._closest.above.insertBefore(i,this._tree._getFirstChild(this._closest.above,!0));else if(a>t.x-n)this._closest.above.parentNode.appendChild(i);else{let e=this._closest.above;for(;e!==s&&a<t.x;)(e=this._tree._getParent(e))!==s&&(t=m(e.querySelector(`.${this._tree.prefixClassName}-name`)));e.appendChild(i)}}else s.insertBefore(i,this._tree._getFirstChild(s));else s.appendChild(i)}}_up(e){var t,s;this._target&&(this._moving?((t=this._indicator.get()).parentNode.insertBefore(this._target,t),this._tree.expand(t.parentNode),(s=t.parentNode.__leafInstance)&&s.showIcon(),this._target.style.position="unset"===this._old.position?"":this._old.position,this._target.querySelector(`.${this._tree.prefixClassName}-name`).style.boxShadow="unset"===this._old.boxShadow?"":this._old.boxShadow,this._target.style.opacity="unset"===this._old.opacity?"":this._old.opacity,t.remove(),this._moveData(),this._tree.emit("move",this._target,this._tree),this._tree.emit("update",this._target,this._tree)):(!this._tree.expandOnClick||this._tree.select&&!this._isDown.alreadySelected||this._tree.toggleExpand(this._target),this._tree.emit("clicked",this._target,e,this._tree)),this._holdTimeout&&(window.clearTimeout(this._holdTimeout),this._holdTimeout=null),this._target=this._moving=null,this._isDown=null)}_moveData(){this._target.data.parent.task.splice(this._target.data.parent.task.indexOf(this._target.data),1),this._target.parentNode.data.task.splice(function(e,t){let s=0;for(var i of e.children){if(i===t)return s;s++}return-1}(this._target.parentNode,this._target),0,this._target.data),this._target.data.parent=this._target.parentNode.data}_indicatorMarginLeft(e){this._indicator.marginLeft=e}},g={move:!0,select:!0,indentation:20,threshold:10,holdTime:1e3,expandOnClick:!1,dragOpacity:.75,prefixClassName:"mb-task",cursorName:"grab -webkit-grab pointer",cursorExpand:"pointer",edit:!0,symbols:{oracles:"#",tags:"@",actions:">"}};(function(){function i(e,t){for(var s=0;s<t.length;s++){var i=t[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(e,t,s){return t&&i(e.prototype,t),s&&i(e,s),e}})()(x,[{key:"destroy",value:function(){this.element.removeEventListener("click",this.events.mouseclick),this.element.removeEventListener("dblclick",this.events.mousedblclick),this.element.removeEventListener("touchstart",this.events.touchstart),this.element.removeEventListener("touchmove",this.events.touchmove),this.element.removeEventListener("touchcancel",this.events.touchcancel),this.element.removeEventListener("touchend",this.events.touchend)}},{key:"touchstart",value:function(e){1===e.touches.length&&(this.lastX=e.changedTouches[0].screenX,this.lastY=e.changedTouches[0].screenY,this.down=!0)}},{key:"pastThreshhold",value:function(e,t){return Math.abs(this.lastX-e)>this.threshhold||Math.abs(this.lastY-t)>this.threshhold}},{key:"touchmove",value:function(e){var t;this.down&&1===e.touches.length&&(t=e.changedTouches[0].screenX,e=e.changedTouches[0].screenY,!this.pastThreshhold(t,e))||this.touchcancel()}},{key:"touchcancel",value:function(){this.down=!1}},{key:"touchend",value:function(e){this.down&&(e.preventDefault(),this.callback)&&this.callback(e,this.options.args)}},{key:"mouseclick",value:function(e){this.callback&&this.callback(e,this.options.args)}},{key:"mousedblclick",value:function(e){this.doubleClickCallback&&this.doubleClickCallback(e,this.options.args)}}]);var y=x;function x(e,t,s){var i=this;if(!(this instanceof x))throw new TypeError("Cannot call a class as a function");this.options=s,this.threshhold=this.options.threshhold||10,this.events={mouseclick:function(e){return i.mouseclick(e)},mousedblclick:function(e){return i.mousedblclick(e)},touchstart:function(e){return i.touchstart(e)},touchmove:function(e){return i.touchmove(e)},touchcancel:function(e){return i.touchcancel(e)},touchend:function(e){return i.touchend(e)}},e.addEventListener("click",this.events.mouseclick),e.addEventListener("dblclick",this.events.mousedblclick),e.addEventListener("touchstart",this.events.touchstart,{passive:!0}),e.addEventListener("touchmove",this.events.touchmove,{passive:!0}),e.addEventListener("touchcancel",this.events.touchcancel),e.addEventListener("touchend",this.events.touchend),this.element=e,this.callback=t,this.doubleClickCallback=this.options.doubleClickCallback}var k=function(e,t,s={}){return new y(e,t,s)},C=class E{constructor(e,t,s){this.data=e,this.tree=s,this.level=t,this.element=_({className:s.prefixClassName+"-leaf"}),this.element.isLeaf=!0,(this.element.__leafInstance=this).element.data=e,this.element.content=_({parent:this.element,className:s.prefixClassName+"-content"}),this.element.style.marginLeft=s.indentation+"px";var i,n=s.prefixClassName+"-expand"+(e.expanded?" expanded":"");this.element.icon=_({parent:this.element.content,className:n.trim()}),this.element.name=_({parent:this.element.content,html:e.name,className:s.prefixClassName+"-name"}),this.element.handler=_({parent:this.element.content,className:s.prefixClassName+"-leaf-handler"}),this.element.handler.addEventListener("mousedown",e=>s._input._down(e)),this.element.handler.addEventListener("touchstart",e=>s._input._down(e)),this.element.name.addEventListener("mousedown",e=>{s._input._down(e),this.selectModeLeaf(),console.log("mousedown")}),k(this.element.name,()=>{},{doubleClickCallback:()=>{s.taskEditor&&"function"==typeof s.taskEditor.editTask?(s.taskEditor.editTask(this),this.editModeLeaf()):console.error("editTask method not found in taskEditor")}}),e.task=e.task||[];for(i of e.task){var a=new E(i,t+1,s);a.data.parent=e,this.element.appendChild(a.element),e.expanded||(a.element.style.display="none")}0===this.getChildren(!0).length&&this.hideIcon(),this.element.icon.addEventListener("click",()=>s.toggleExpand(this.element)),s.emit("render",this.element,s)}getChildren(e){var t,s=[];for(t of this.element.children)t.isLeaf&&(e||"none"!==t.style.display)&&s.push(t);return s}hideIcon(){this.element.isLeaf&&this.element.icon.classList.add("hidden")}showIcon(){this.element.isLeaf&&this.element.icon.classList.remove("hidden")}selectModeLeaf(){var e=document.querySelector(`.${this.tree.prefixClassName}-leaf-select`),e=(e&&e.classList.remove(this.tree.prefixClassName+"-leaf-select"),document.querySelector("#taskeditor"));e.classList.contains(this.tree.prefixClassName+"-edit-mode")&&(e.classList.remove(this.tree.prefixClassName+"-edit-mode"),e.classList.add(this.tree.prefixClassName+"-select-mode"),this.tree.taskEditor.resetTaskArea()),this.element.classList.add(this.tree.prefixClassName+"-leaf-select")}editModeLeaf(){var e=document.querySelector(`.${this.tree.prefixClassName}-leaf-edit`),e=(e&&e.classList.remove(this.tree.prefixClassName+"-leaf-edit"),document.querySelector("#taskeditor"));e.classList.contains(this.tree.prefixClassName+"-select-mode")&&(e.classList.remove(this.tree.prefixClassName+"-select-mode"),e.classList.add(this.tree.prefixClassName+"-edit-mode")),this.element.classList.add(this.tree.prefixClassName+"-leaf-edit")}},b=class{constructor(e){this.tree=e,this.currentTask=null,this.taskArea=document.getElementById("taskarea"),this.createTaskBtn=document.getElementById("createTaskBtn"),this.editTaskBtn=document.getElementById("editTaskBtn"),this.placeholderText=this.taskArea.getAttribute("data-placeholder"),this.createTaskBtn.addEventListener("click",()=>this.createTask()),this.editTaskBtn.addEventListener("click",()=>this.updateTask()),this.taskArea.addEventListener("input",()=>this.onTaskAreaInput()),this.setupPlaceholder()}setupPlaceholder(){var e=()=>{""===this.taskArea.innerText.trim()&&(this.taskArea.innerText=this.placeholderText,this.taskArea.classList.add("placeholder"))};this.taskArea.addEventListener("focus",()=>{this.taskArea.innerText===this.placeholderText&&(this.taskArea.innerText="",this.taskArea.classList.remove("placeholder"))}),this.taskArea.addEventListener("blur",e),e()}createTask(){var e,t,s=this.taskArea.innerText.trim();s&&s!==this.placeholderText&&(s={name:s,task:[]},(t=document.querySelector(`.${this.tree.prefixClassName}-leaf-select`))?(t=t.__leafInstance)&&t.data?(e=t.data.parent)?(t=e.task.indexOf(t.data),e.task.splice(t+1,0,s)):console.error("Parent task not found for the selected leaf"):console.error("Selected leaf instance or its data is not defined"):this.tree.element.data&&this.tree.element.data.task?this.tree.element.data.task.push(s):console.error("Tree data or tree data task array is not defined"),this.tree.update(),this.resetTaskArea())}updateTask(){this.currentTask&&(this.currentTask.data.name=this.taskArea.innerText.replace(/\s+$/,""),this.tree.update(),this.resetTaskArea())}onTaskAreaInput(){this.taskArea.innerText.trim()}resetTaskArea(){this.taskArea.innerText="",this.taskArea.blur(),this.currentTask=null}editTask(e){this.currentTask=e,this.taskArea.innerHTML=e.data.name+"&nbsp;",this.taskArea.focus();var e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.taskArea),e.collapse(!1),t.removeAllRanges(),t.addRange(e)}},L=class extends c.default{constructor(e,t){super(),this._options=function(e,t){for(var s in e=e||{},t)e[s]=(void 0!==e[s]?e:t)[s];return e}(t,g),this._input=new v(this),this.taskEditor=new b(this),void 0===this._options.element?this.element=document.createElement("div"):this.element=d(this._options.element),this._options.parent&&d(this._options.parent).appendChild(this.element),this.element.classList.add(this.prefixClassName),this.element.data=e,this.update()}get selection(){return this._selection.data}set selection(e){}get prefixClassName(){return this._options.prefixClassName}set prefixClassName(e){e!==this._options.prefixClassName&&(this._options.prefixClassName=e,this.update())}get indentation(){return this._options.indentation}set indentation(e){e!==this._options.indentation&&(this._options.indentation=e,this._input._indicatorMarginLeft=e+"px",this.update())}get holdTime(){return this._options.holdTime}set holdTime(e){e!==this._options.holdTime&&(this._options.holdTime=e)}get move(){return this._options.move}set move(e){this._options.move=e}get expandOnClick(){return this._options.expandOnClick}set expandOnClick(e){this._options.expandOnClick=e}get select(){return this._options.select}set select(e){this._options.select=e}get dragOpacity(){return this._options.dragOpacity}set dragOpacity(e){this._options.dragOpacity=e}expandAll(){this._expandChildren(this.element)}_expandChildren(e){for(var t of this._getChildren(e,!0))this.expand(t),this._expandChildren(t)}collapseAll(){this._collapseChildren(this.element)}_collapseChildren(e){for(var t of this._getChildren(e,!0))this.collapse(t),this._collapseChildren(t)}toggleExpand(e){e.icon.classList.contains("hidden")||(e.data.expanded?this.collapse(e):this.expand(e))}expand(e){if(e.isLeaf){var t=this._getChildren(e,!0);if(t.length){for(var s of t)s.style.display="block";e.data.expanded=!0,e.icon.classList.add("expanded"),this.emit("expand",e,this),this.emit("update",e,this)}}}collapse(e){if(e.isLeaf){var t=this._getChildren(e,!0);if(t.length){for(var s of t)s.style.display="none";e.data.expanded=!1,e.icon.classList.remove("expanded"),this.emit("collapse",e,this),this.emit("update",e,this)}}}update(){for(var e,t=this.element.scrollTop,s=this.element;s.firstChild;)s.firstChild.remove();for(e of this.element.data.task){var i=new C(e,0,this);i.data.parent=this.element.data,i.element.__leafInstance=i,this.element.appendChild(i.element)}this.element.scrollTop=t+"px"}_getFirstChild(e,t){e=this._getChildren(e,t);if(e.length)return e[0]}_getLastChild(e,t){e=this._getChildren(e,t);if(e.length)return e[e.length-1]}_getParent(e){for(e=e.parentNode;"none"===e.style.display;)e=e.parentNode;return e}_getChildren(e,t){var s,i=[];for(s of(e=e||this.element).children)s.isLeaf&&(t||"none"!==s.style.display)&&i.push(s);return i}},c=s(h()),w=class extends c.default{constructor(e,t){super(),this.taskArea=e,this.popup=t,this.currentCategory="",this.currentKey="",this.initEventListeners()}initEventListeners(){this.taskArea.addEventListener("input",this.handleTaskAreaInput.bind(this)),document.querySelector("#addTags").addEventListener("click",()=>this.openPopup("tags")),document.querySelector("#addActions").addEventListener("click",()=>this.openPopup("actions")),document.querySelector("#addOracles").addEventListener("click",()=>this.openPopup("oracles")),document.querySelector("#addTags").addEventListener("click",()=>this.addKeyToTaskArea("@")),document.querySelector("#addActions").addEventListener("click",()=>this.addKeyToTaskArea(">")),document.querySelector("#addOracles").addEventListener("click",()=>this.addKeyToTaskArea("#")),this.popup.on("select",this.handlePopupSelect.bind(this)),this.popup.on("close",this.handlePopupClose.bind(this))}handleTaskAreaInput(e){e=e.target.innerText,e=e[e.length-1];["@",">","#"].includes(e)&&this.openPopup("@"===e?"tags":">"===e?"actions":"oracles")}addKeyToTaskArea(e){this.taskArea.innerText===this.taskArea.getAttribute("data-placeholder")&&(this.taskArea.innerText=""),this.taskArea.innerHTML+=e}openPopup(e,t=0){console.log("Opening popup for category:",e),this.currentCategory=e,this.popup.buildPopup(e)}handlePopupSelect({key:e,value:t}){console.log("Selected:",e,t),this.insertSelectedValue(e,t)}insertSelectedValue(e,t){e+=`(${t})&nbsp;`;console.log("Text to insert:",JSON.stringify(e)),this.taskArea.innerHTML+=e,this.placeCursorAtEnd(),this.resetState()}placeCursorAtEnd(){var e=document.createRange(),t=window.getSelection();e.selectNodeContents(this.taskArea),e.collapse(!1),t.removeAllRanges(),t.addRange(e),this.taskArea.focus()}handlePopupClose(){this.placeCursorAtEnd()}resetState(){this.popup.hide(),this.currentCategory="",this.currentKey=""}},c=s(h()),T=class extends c.default{constructor(e){super(),this.element=document.getElementById("autocomplete-popup"),this.inputField=document.getElementById("autocomplete-input"),this.listElement=document.getElementById("autocomplete-list"),this.inputField.addEventListener("input",this.handleInput.bind(this)),this.inputField.addEventListener("keydown",this.handleKeyDown.bind(this)),this.element.addEventListener("click",this.handleClick.bind(this)),this.hide()}buildPopup(e){this.currentSuggestions=Object.keys(window.suggestions[e]),this.currentCategory=e,this.currentKey="",this.renderList(this.currentSuggestions),setTimeout(()=>this.inputField.focus(),0)}renderList(e,t=0){this.activeElementIndex=t,this.clearList(),e.forEach((e,t)=>{var s=document.createElement("div");s.textContent=e,s.classList.add("element-item"),t===this.activeElementIndex&&s.classList.add("active"),this.listElement.appendChild(s)}),this.element.style.display="block"}handleInput(e){let t=e.target.value.toLowerCase();e=this.currentSuggestions.filter(e=>e.toLowerCase().includes(t));0<e.length?this.renderList(e):this.showNoResults(),this.emit("input",t)}handleKeyDown(e){var t=e.key,s=Array.from(this.listElement.querySelectorAll(".element-item"));"ArrowDown"===t?(this.activeElementIndex=(this.activeElementIndex+1)%s.length,this.renderList(this.currentSuggestions,this.activeElementIndex)):"ArrowUp"===t?(this.activeElementIndex=(this.activeElementIndex-1+s.length)%s.length,this.renderList(this.currentSuggestions,this.activeElementIndex)):"Enter"===t?(this.handleSelection(s[this.activeElementIndex].textContent),e.preventDefault()):"Tab"===t?(e.preventDefault(),this.activeElementIndex=(this.activeElementIndex+1)%s.length,this.renderList(this.currentSuggestions,this.activeElementIndex)):"Backspace"===t&&""===this.inputField.value&&(this.hide(),this.emit("close"))}handleSelection(e){this.inputField.value="";var t=window.suggestions[this.currentCategory][e];t?(this.currentKey=e,this.currentSuggestions=t,this.renderList(t)):this.emit("select",{key:this.currentKey,value:e})}handleClick(e){e=Array.from(this.listElement.children).indexOf(e.target);0<=e&&this.handleSelection(this.currentSuggestions[e])}clearList(){this.listElement.innerHTML=""}showNoResults(){this.clearList();var e=document.createElement("div");e.textContent="Value not found",e.classList.add("no-results"),this.listElement.appendChild(e)}hide(){this.element.style.display="none"}};window.onload=function(){var e,t;e=window.tasks,new L(e,{parent:document.getElementById("tasktree")}).expandAll(),e=document.getElementById("taskeditor"),e=new T(e),t=document.getElementById("taskarea"),e=new w(t,e),t.addEventListener("input",e.handleTaskAreaInput.bind(e))}})();